(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();const{Vector3:U,Quaternion:N,Euler:I}=THREE;class M{}class R{data;constructor(t){this.data={position:{x:t?.position?.x||0,y:t?.position?.y||0,z:t?.position?.z||0},rotation:{x:t?.rotation?.x||0,y:t?.rotation?.y||0,z:t?.rotation?.z||0},scale:{x:t?.scale?.x||0,y:t?.scale?.y||0,z:t?.scale?.z||0}}}update(t){t.position&&(this.data.position=t.position),t.rotation&&(this.data.rotation=t.rotation),t.scale&&(this.data.scale=t.scale)}getPosition(){return{...this.data.position}}getRotation(){return{...this.data.rotation}}getScale(){return{...this.data.scale}}static updateHtmlElement(t,e){const i=t.getPosition(),r=t.getRotation(),s=t.getScale();e.setAttribute("position",`${i.x} ${i.y} ${i.z}`),e.setAttribute("rotation",`${r.x} ${r.y} ${r.z}`),e.setAttribute("scale",`${s.x} ${s.y} ${s.z}`)}}function z(c,t,e){return Math.max(t,Math.min(e,c))}const L={x:{min:-5,max:5},y:{min:-5,max:5},z:{min:-15,max:15}},F={x:0,y:0,z:0};class O extends M{markerDimensions;positionalOffsetVector;vectorRotationLimits;renderData;renderObj;modelName;modelPath;constructor(t){super(),this.markerDimensions=t.markerDimensions,this.positionalOffsetVector=t.positionalOffsetVector||F,this.modelName=t.modelName,this.modelPath=t.modelPath,this.renderData=new R,this.vectorRotationLimits=t.vectorRotationLimits||L}init(){return new Promise((t,e)=>{const i=document.getElementById(this.modelName);if(!i){console.error("Asset element not found:",this.modelName),t();return}const r=()=>{this.renderObj&&this.renderObj.setAttribute("gltf-model",`#${this.modelName}`),t()};i.hasLoaded?r():i.addEventListener("loaded",r)})}createAssets(){const t=document.createElement("a-asset-item");return t.setAttribute("id",this.modelName),t.setAttribute("src",this.modelPath),t.setAttribute("response-type","arraybuffer"),[t]}createAFrameElement(){if(this.renderObj===void 0){const t=document.createElement("a-entity");t.setAttribute("id","gltf-obj"),t.setAttribute("position","0 0 0"),t.setAttribute("rotation","0 0 0"),t.setAttribute("scale","0 0 0"),t.setAttribute("visible","false"),this.renderObj=t}return this.renderObj}onFirstSeen(){this.renderObj?.setAttribute("visible","true")}onMarkerFound(){}onMarkerLost(){}tickUpdate(t){if(this.renderObj===void 0)throw new Error("tickUpdate called in GltfModelRenderTarget before renderObj initialized");const e=t.marker.historic.reduce((r,s)=>(r.position.x+=s.position.x,r.position.y+=s.position.y,r.position.z+=s.position.z,r.rotation.x+=s.rotation.x,r.rotation.y+=s.rotation.y,r.rotation.z+=s.rotation.z,r.scale.x+=s.scale.x,r.scale.y+=s.scale.y,r.scale.z+=s.scale.z,r),{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:0,y:0,z:0}}),i=t.marker.historic.length;e.position.x/=i,e.position.y/=i,e.position.z/=i,e.rotation.x/=i,e.rotation.y/=i,e.rotation.z/=i,e.scale.x/=i,e.scale.y/=i,e.scale.z/=i,e.scale.x*=.75,e.scale.y*=.75,e.scale.z*=.75,e.rotation.x=z(e.rotation.x,this.vectorRotationLimits.x.min??-360,this.vectorRotationLimits.x.max??360),e.rotation.y=z(e.rotation.y,this.vectorRotationLimits.y.min??-360,this.vectorRotationLimits.y.max??360),e.rotation.z=z(e.rotation.z,this.vectorRotationLimits.z.min??-360,this.vectorRotationLimits.z.max??360),this.renderData.update(e),R.updateHtmlElement(this.renderData,this.renderObj)}}class f{vector;dimensions;constructor(){this.vector={x:0,y:0,z:0},this.dimensions={width:0,height:0}}update({x:t,y:e,z:i,width:r,height:s}){typeof t=="number"&&(this.vector.x=t),typeof e=="number"&&(this.vector.y=e),typeof i=="number"&&(this.vector.z=i),typeof r=="number"&&(this.dimensions.width=r),typeof s=="number"&&(this.dimensions.height=s)}getPositionString(){return`${this.vector.x} ${this.vector.y} ${this.vector.z}`}getWidthString(){return`${this.dimensions.width}`}getHeightString(){return`${this.dimensions.height}`}static updateHtmlElement(t,e){e.setAttribute("position",t.getPositionString()),e.setAttribute("width",t.getHeightString()),e.setAttribute("height",t.getHeightString())}}class ${frameCount;lastTime;fps;constructor(){this.frameCount=0,this.lastTime=0,this.fps=0}update(t){if(this.frameCount++,this.lastTime>0){const e=t-this.lastTime;e>0&&(this.fps=Math.round(1e3/e))}this.lastTime=t}get(){return{frameCount:this.frameCount,fps:this.fps}}}const{Vector3:w,Quaternion:P,Euler:H}=THREE,S=12;class j{debug;htmlElements;flags;fpsData;markerData;cornerData;renderTarget;constructor({renderTarget:t,isDebugging:e}){this.flags={sceneStarted:!1},this.fpsData=new $,this.markerData={found:!1,current:{position:new w,scale:new w,rotation:new w,quaternion:new P,euler:new H},historic:[]},this.cornerData={bottomLeft:new f,bottomRight:new f,topLeft:new f,topRight:new f},this.renderTarget=t;const{htmlElements:i,debug:r}=this.createScene(e);this.htmlElements=i,this.debug=r,AFRAME.registerComponent("frame-scene",{init:this.init.bind(this),tick:this.tick.bind(this)})}createScene(t){const e=document.querySelector("body");if(e===null)throw new Error("Body cannot be null");const i=document.createElement("a-scene");i.setAttribute("id","scene"),i.setAttribute("frame-scene",""),i.setAttribute("mindar-image","imageTargetSrc: ./targets.mind;"),i.setAttribute("vr-mode-ui","enabled: false"),i.setAttribute("device-orientation-permission-ui","enabled: false");const r=document.createElement("a-assets");this.renderTarget.createAssets()?.forEach(a=>r.appendChild(a));const o=document.createElement("a-camera");o.setAttribute("position","0 0 0"),o.setAttribute("look-controls","enabled: false");const n=document.createElement("a-entity");n.setAttribute("id","marker"),n.setAttribute("mindar-image-target","targetIndex: 0");const b=this.renderTarget.createAFrameElement();i.appendChild(r),i.appendChild(o),i.appendChild(n),i.appendChild(b);const v={camera:o,marker:n,scene:i};let T={isDebugging:!1};if(t){const a=document.createElement("a-plane");a.setAttribute("id","topLeft"),a.setAttribute("position","10000 10000 10000"),a.setAttribute("width","1"),a.setAttribute("height","1"),a.setAttribute("color","red");const d=document.createElement("a-plane");d.setAttribute("id","topRight"),d.setAttribute("position","10000 10000 10000"),d.setAttribute("width","1"),d.setAttribute("height","1"),d.setAttribute("color","green");const l=document.createElement("a-plane");l.setAttribute("id","bottomLeft"),l.setAttribute("position","10000 10000 10000"),l.setAttribute("width","1"),l.setAttribute("height","1"),l.setAttribute("color","blue");const h=document.createElement("a-plane");h.setAttribute("id","bottomRight"),h.setAttribute("position","10000 10000 10000"),h.setAttribute("width","1"),h.setAttribute("height","1"),h.setAttribute("color","yellow");const m=document.createElement("div");m.setAttribute("id","dev-tools"),m.setAttribute("data-show-status","showing");const g=document.createElement("button");g.setAttribute("id","dev-tools-show-hide-btn"),g.textContent="Hide Dev Tools";const y=document.createElement("div");y.setAttribute("id","notice-board-misc"),y.setAttribute("class","notice-board-div");const x=document.createElement("ul");x.setAttribute("class","notice-board");const p=document.createElement("li");p.setAttribute("id","notice-marker-found"),p.setAttribute("data-status","bad"),p.textContent="Marker Lost";const A=document.createElement("li");A.setAttribute("id","notice-fps-display"),A.textContent="FPS: -",x.appendChild(p),x.appendChild(A),y.appendChild(x);const k=document.createElement("div");k.setAttribute("id","notice-board-marker"),k.setAttribute("class","notice-board-div");const u=document.createElement("ul");u.setAttribute("class","notice-board"),u.setAttribute("data-show-status","showing");const D=document.createElement("li");D.setAttribute("id","notice-marker-position"),D.textContent="Pos: -";const E=document.createElement("li");E.setAttribute("id","notice-marker-rotation"),E.textContent="Rot: -";const C=document.createElement("li");C.setAttribute("id","notice-marker-scale"),C.textContent="Scl: -",u.appendChild(D),u.appendChild(E),u.appendChild(C),k.appendChild(u),m.appendChild(g),m.appendChild(y),m.appendChild(k),i.append(a),i.append(d),i.append(l),i.append(h),e.append(m),T={isDebugging:!0,elements:{fps:{display:A,foundMarker:p},marker:{position:D,rotation:E,scale:C},corners:{bottomLeft:l,bottomRight:h,topLeft:a,topRight:d},devTools:m,showHideBtn:g}}}return e.append(i),{htmlElements:v,debug:T}}init(){this.renderTarget.init(),this.registerArEvents(),this.debug.isDebugging&&this.registerDevToolEvents()}tick(t,e){this.fpsData.update(t),this.tickUpdateScreenCornerData(),this.tickUpdateMarkerData(),this.tickUpdateScreenCornerHtml(),this.tickUpdateDevToolsFpsCounter(),this.tickUpdateDevToolsMarkerDisplay(),this.renderTarget.tickUpdate({marker:this.markerData,corners:this.cornerData})}registerDevToolEvents(){if(this.debug.isDebugging){const{devTools:t,showHideBtn:e}=this.debug.elements;e.addEventListener("click",()=>{t.getAttribute("data-show-status")==="showing"?(t.setAttribute("data-show-status","hidden"),e.textContent="Show Dev Tools"):(t.setAttribute("data-show-status","showing"),e.textContent="Hide Dev Tools")})}}registerArEvents(){const{scene:t,marker:e}=this.htmlElements;t.addEventListener("arReady",()=>{this.syncCameraProperties()}),e.addEventListener("targetFound",()=>{this.markerData.found=!0,this.flags.sceneStarted||(this.flags.sceneStarted=!0,this.renderTarget.onFirstSeen(),document.querySelector(".mindar-ui-scanning")?.remove()),this.debug.isDebugging&&(this.debug.elements.fps.foundMarker.textContent="Marker Found",this.debug.elements.fps.foundMarker.setAttribute("data-status","good")),this.renderTarget.onMarkerFound({marker:this.markerData,corners:this.cornerData})}),e.addEventListener("targetLost",()=>{this.markerData.found=!1,this.debug.isDebugging&&(this.debug.elements.fps.foundMarker.textContent="Marker Lost",this.debug.elements.fps.foundMarker.setAttribute("data-status","bad")),this.renderTarget.onMarkerLost({marker:this.markerData,corners:this.cornerData})})}syncCameraProperties(){const{camera:t}=this.htmlElements,e=this.getThreeCameraEntityValues();t.setAttribute("camera",{fov:e.fov,near:e.near,far:e.far})}tickUpdateMarkerData(){if(this.markerData.found){const t=this.htmlElements.marker.object3D;t.updateMatrixWorld(!0);const{position:e,rotation:i,scale:r,euler:s,quaternion:o}=this.markerData.current;t.matrixWorld.decompose(e,o,r),s.setFromQuaternion(o,"XYZ");const n=AFRAME.THREE.MathUtils.radToDeg;i.x=n(s.x),i.y=n(s.y),i.z=n(s.z),this.markerData.historic.push({position:{x:e.x,y:e.y,z:e.z},rotation:{x:i.x,y:i.y,z:i.z},scale:{x:r.x,y:r.y,z:r.z}}),this.markerData.historic.length>S&&(this.markerData.historic=this.markerData.historic.slice(-S,this.markerData.historic.length))}}tickUpdateScreenCornerHtml(){this.debug.isDebugging&&Object.entries(this.debug.elements.corners).forEach(([t,e])=>{f.updateHtmlElement(this.cornerData[t],e)})}tickUpdateScreenCornerData(){const{zDistance:t,halfHeight:e,halfWidth:i}=this.calculateScreenCorners();this.cornerData.topLeft.update({x:-i,y:e,z:t,width:1,height:1}),this.cornerData.topRight.update({x:i,y:e,z:t,width:1,height:1}),this.cornerData.bottomLeft.update({x:-i,y:-e,z:t,width:1,height:1}),this.cornerData.bottomRight.update({x:i,y:-e,z:t,width:1,height:1})}tickUpdateDevToolsFpsCounter(){this.debug.isDebugging&&(this.debug.elements.fps.display.textContent=`FPS: ${this.fpsData.get().fps}`)}tickUpdateDevToolsMarkerDisplay(){if(this.debug.isDebugging){const{position:t,rotation:e,scale:i}=this.debug.elements.marker;this.markerData.found?(t.textContent=`Pos: {x: ${this.markerData.current.position.x.toFixed(1)}, y: ${this.markerData.current.position.y.toFixed(1)}, z: ${this.markerData.current.position.z.toFixed(1)}}`,e.textContent=`Rot: {x: ${this.markerData.current.rotation.x.toFixed(1)}°, y: ${this.markerData.current.rotation.y.toFixed(1)}°, z: ${this.markerData.current.rotation.z.toFixed(1)}°}`,i.textContent=`Scl: {x: ${this.markerData.current.scale.x.toFixed(1)}, y: ${this.markerData.current.scale.y.toFixed(1)}, z: ${this.markerData.current.scale.z.toFixed(1)}}`):(t.textContent="Pos: {x: ???, y: ???, z: ???}",e.textContent="Rot: {x: ???°, y: ???°, z: ???°}",i.textContent="Scl: {x: ???, y: ???, z: ???}")}}getThreeCameraEntityValues(){const{camera:t}=this.htmlElements,{object3D:e}=t;if(e.children.length===0)throw new Error("#camera.object3d children is 0");const i=e.children[0];if(!("near"in i)||!("far"in i)||!("fov"in i)||!("aspect"in i)||typeof i.near!="number"||typeof i.far!="number"||typeof i.fov!="number"||typeof i.aspect!="number")throw new Error("threeCamera must be instance of PerspectiveCamera");return{near:i.near,far:i.far,fov:i.fov,aspect:i.aspect}}calculateScreenCorners(){const t=this.getThreeCameraEntityValues(),{near:e,fov:i,aspect:r}=t,s=-e,o=i/2*(Math.PI/180),n=Math.tan(o),b=e*n,v=b*r;return{zDistance:s,halfHeight:b,halfWidth:v}}}new j({isDebugging:!1,renderTarget:new O({modelName:"ModelTarget",modelPath:"assets/testmodel.gltf",markerDimensions:{x:1.6,y:.9}})});
